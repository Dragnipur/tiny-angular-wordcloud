angular.module("tangcloud",[]).directive("tangCloud",["$interpolate","$compile","$timeout",function(a,b,c){var d={restrict:"E",scope:{words:"=",onClick:"&",hasLinks:"="},template:function(a,b){var c=angular.isDefined(b.onClick),d=c?'ng-click="onClick({word : entry.word, id : entry.id})"':"",e="{{entry.word}}";return angular.isDefined(b.hasLinks)&&(e='<a data-ng-href="{{entry.href}}">'+e+"</a>"),'<div class="tangcloud"><span ng-repeat="entry in words" '+d+">"+e+"</span></div>"},compile:function(b){return b.children().children().addClass("tangcloud-item-"+a.startSymbol()+"entry.size"+a.endSymbol()).addClass("tangcloud-item-hidden"),function(a,b){a.$watch("words",function(){function d(){a.width=o.offsetWidth,a.height=o.offsetHeight,a.centerX=a.width/2,a.centerY=a.height/2,a.borders={left:a.centerX-a.width/2,right:a.centerX+a.width/2,bottom:a.centerY-a.height/2,top:a.centerY+a.height/2},a.outOfBoundsCount=0,a.takenSpots=[],a.lastCollisionSpot=-1}function e(){a.words&&(f(),g())}function f(){for(var b=a.words.length-1;b>0;b--){var c=Math.floor(Math.random()*(b+1)),d=a.words[b];a.words[b]=a.words[c],a.words[c]=d}}function g(){c(function(){for(var a=b.children().eq(0).children(),c=a.length,d=0;c>d;d++)h(a.eq(d))})}function h(b){for(var c=i(b[0]),d=0;k(c)&&a.outOfBoundsCount<50;)c=j(c,d),d+=1;a.outOfBoundsCount<50&&(a.takenSpots.push(c),n(b,c.startX,c.startY)),a.outOfBoundsCount=0}function i(b){var c=b.offsetWidth,d=parseInt(window.getComputedStyle(b).lineHeight,10);return{width:c,height:d,startX:a.centerX-c/2,startY:a.centerY-d/2,endX:a.centerX+c/2,endY:a.centerY+d/2}}function j(b,c){var d=.1*c;return b.startX=a.centerX+1.5*d*Math.cos(d)-b.width/2,b.startY=a.centerY+d*Math.sin(d)-b.height/2,b.endX=b.startX+b.width,b.endY=b.startY+b.height,b}function k(b){if(l(b))return!0;if(-1!=a.lastCollisionSpot&&m(b,a.takenSpots[a.lastCollisionSpot]))return!0;for(var c=0;c<a.takenSpots.length;c++)if(c!=a.lastCollisionSpot&&m(b,a.takenSpots[c]))return a.lastCollisionSpot=c,!0;return a.lastCollisionSpot=-1,!1}function l(b){return b.startX<a.borders.left||b.endX>a.borders.right||b.startY<a.borders.bottom||b.endY>a.borders.top?(a.outOfBoundsCount++,!0):!1}function m(a,b){return a.startX>b.endX||a.endX<b.startX?!1:!(a.startY>b.endY||a.endY<b.startY)}function n(a,b,c){var d="position: absolute; left:"+b+"px; top: "+c+"px;";a.attr("style",d),a.removeClass("tangcloud-item-hidden")}var o=b.children().eq(0)[0];d(),e()})}}};return d}]);